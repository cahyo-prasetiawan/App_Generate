<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP Generate Image</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Plus+Jakarta+Sans', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            overflow-x: hidden;
        }

        .glass-premium {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .premium-glow {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
        }

        .btn-gold {
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 50%, #db2777 100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-gold:hover:not(:disabled) {
            filter: brightness(1.15);
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(124, 58, 237, 0.4);
        }

        .image-card {
            position: relative;
            overflow: hidden;
            border-radius: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            background: #0f172a;
            /* Chessboard pattern for transparency preview */
            background-image: linear-gradient(45deg, #1e293b 25%, transparent 25%), 
                              linear-gradient(-45deg, #1e293b 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #1e293b 75%), 
                              linear-gradient(-45deg, transparent 75%, #1e293b 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .image-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 60%);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 1.5rem;
            opacity: 1;
        }

        @media (min-width: 768px) {
            .image-overlay { opacity: 0; transition: opacity 0.3s ease; }
            .image-card:hover .image-overlay { opacity: 1; }
        }

        .quality-badge {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Toggle styling */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #1e293b;
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: #3b82f6; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body class="min-h-screen">
    <nav class="p-5 border-b border-white/5 sticky top-0 z-50 glass-premium">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-tr from-blue-600 to-pink-600 rounded-xl flex items-center justify-center premium-glow">
                    <i class="fas fa-gem text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight">Asset<span class="text-blue-400">Forge</span></h1>
                    <p class="text-[10px] text-blue-400 font-black uppercase tracking-widest">Ultra HD Studio v5.0</p>
                </div>
            </div>
            <div class="hidden md:flex items-center space-x-2 quality-badge px-3 py-1 rounded-full">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-[10px] font-bold text-white uppercase tracking-tighter">HD Engine Active</span>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 mt-10 pb-20">
        <div class="grid lg:grid-cols-12 gap-10">
            
            <!-- Sidebar Konfigurasi -->
            <div class="lg:col-span-4 space-y-6">
                <div class="glass-premium p-6 rounded-3xl space-y-8 lg:sticky lg:top-28 border-white/10">
                    <div class="flex items-center justify-between">
                        <h2 class="text-sm font-bold uppercase tracking-widest text-slate-400">Parameter Studio</h2>
                        <span class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded font-black">PRO</span>
                    </div>

                    <!-- Prompt Input -->
                    <div class="space-y-3">
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-tighter">Deskripsi Objek</label>
                        <textarea id="prompt-input" rows="5" 
                            class="w-full bg-slate-900/80 border border-white/10 rounded-2xl p-4 text-sm text-white focus:ring-2 focus:ring-blue-500/50 focus:outline-none transition-all placeholder:text-slate-600"
                            placeholder="Contoh: Seekor kucing astronot di bulan, detail bulu tajam, pencahayaan dramatis..."></textarea>
                    </div>

                    <!-- Pilihan Gaya (Optimized for HD) -->
                    <div class="space-y-3">
                        <label class="text-xs font-bold text-slate-500 uppercase">Preset Kualitas Tinggi</label>
                        <select id="style-select" class="w-full bg-slate-900 border border-white/10 rounded-xl p-3 text-sm text-white focus:outline-none cursor-pointer hover:bg-slate-800 transition-colors">
                            <option value="ultra realistic, 8k resolution, cinematic lighting, sharp focus, masterwork, highly detailed texture, raw photo, f/1.8">Cinematic Ultra HD (8K)</option>
                            <option value="studio portrait photography, highly detailed skin texture, professional lighting, 8k, sharp eyes, bokeh background">High-End Portrait HD</option>
                            <option value="3d render, octane render, unreal engine 5, masterpiece, volumetric lighting, raytracing, high fidelity, 4k">Premium 3D Concept</option>
                            <option value="macro photography, extreme detail, 8k, sharp focus, natural textures, detailed surfaces">Macro Precision Detail</option>
                            <option value="professional flat vector, high contrast, clean minimalist, sharp edges, 4k graphic design, crisp lines">Professional Vector Art</option>
                            <option value="anime masterpiece, 4k resolution, vibrant colors, clean lineart, studio ghibli style, high fidelity">Ultra Anime 4K</option>
                            <option value="digital painting, hyper-detailed, masterpiece, colorful, smooth brushwork, high resolution, intricate detail">Fine Art Digital</option>
                            <option value="luxury product photography, studio lighting, sharp details, commercial grade, 8k, clean background">Product Photography HD</option>
                            <option value="cyberpunk aesthetic, neon lighting, futuristic city, cinematic bokeh, 8k, highly detailed, sharp">Cyberpunk Neon HD</option>
                            <option value="architectural photography, interior design, high resolution, professional lighting, sharp lines">Modern Architecture HD</option>
                        </select>
                    </div>

                    <!-- Fitur Transparansi -->
                    <div class="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/5">
                        <div class="flex flex-col">
                            <span class="text-xs font-bold text-white uppercase">Background Transparan</span>
                            <span class="text-[10px] text-slate-500">Tanpa latar belakang (PNG style)</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="transparent-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <button id="generate-btn" class="btn-gold w-full py-5 rounded-2xl font-black text-sm uppercase tracking-widest flex items-center justify-center space-x-3 touch-manipulation">
                        <i id="gen-icon" class="fas fa-magic"></i>
                        <span id="gen-text">Generate Ultra HD</span>
                    </button>
                    
                    <p class="text-[9px] text-center text-slate-600 font-medium italic">
                        *Aplikasi ini menggunakan engine AI tingkat tinggi untuk hasil maksimal.
                    </p>
                </div>
            </div>

            <!-- Area Hasil -->
            <div class="lg:col-span-8 space-y-6">
                <!-- Loading State -->
                <div id="loading-overlay" class="hidden glass-premium rounded-[2.5rem] p-10 flex flex-col items-center justify-center min-h-[500px]">
                    <div class="relative w-24 h-24 mb-10">
                        <div class="absolute inset-0 border-t-4 border-blue-500 rounded-full animate-spin"></div>
                        <div class="absolute inset-4 border-b-4 border-pink-500 rounded-full animate-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
                    </div>
                    <div class="text-center space-y-4">
                        <h2 class="text-2xl font-black uppercase tracking-[0.3em] text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-pink-500">Processing HD</h2>
                        <p class="text-xs text-slate-400 font-bold uppercase tracking-widest animate-pulse">Menghaluskan Pixel & Menghapus Background...</p>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="glass-premium rounded-[2.5rem] p-10 flex flex-col items-center justify-center min-h-[500px]">
                    <div class="w-32 h-32 bg-slate-800/20 rounded-full flex items-center justify-center mb-8">
                        <i class="fas fa-wand-sparkles text-slate-700 text-5xl"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-500 uppercase tracking-widest">Studio HD Siap</h3>
                    <p class="text-sm text-slate-600 mt-2">Masukkan instruksi Anda di panel samping</p>
                </div>

                <!-- Result Grid -->
                <div id="result-grid" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6"></div>

                <!-- Footer Actions -->
                <div id="global-actions" class="hidden flex justify-between items-center">
                    <p class="text-[10px] font-bold text-slate-500 uppercase italic">Hasil render 2048px (Ultra HD Optimized)</p>
                    <button id="reset-btn" class="px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 text-xs font-bold rounded-xl transition-all flex items-center space-x-2">
                        <i class="fas fa-trash-alt"></i><span>HAPUS SEMUA</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast UI -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 glass-premium px-8 py-4 rounded-2xl translate-y-32 opacity-0 transition-all duration-500 z-[100] border-l-4 border-blue-500">
        <p id="toast-msg" class="text-xs font-bold uppercase tracking-widest text-slate-200"></p>
    </div>

    <script>
        const apiKey = ""; 
        const idEl = id => document.getElementById(id);
        
        const ui = {
            prompt: idEl('prompt-input'),
            style: idEl('style-select'),
            transToggle: idEl('transparent-toggle'),
            genBtn: idEl('generate-btn'),
            genText: idEl('gen-text'),
            loading: idEl('loading-overlay'),
            empty: idEl('empty-state'),
            resultGrid: idEl('result-grid'),
            globalActions: idEl('global-actions'),
            resetBtn: idEl('reset-btn')
        };

        let controller = null;

        ui.genBtn.onclick = async () => {
            const promptValue = ui.prompt.value.trim();
            if (!promptValue) return showToast("MOHON ISI DESKRIPSI GAMBAR!", "error");

            if (controller) controller.abort();
            controller = new AbortController();

            toggleLoading(true);
            
            try {
                const styleMod = ui.style.value;
                const isTransparent = ui.transToggle.checked;
                
                // Prompt Engineering untuk Full HD & Transparansi
                let finalPrompt = `${promptValue}. ${styleMod}. Extremely detailed, professional quality, high resolution.`;
                
                if (isTransparent) {
                    finalPrompt += " Isolated on a solid plain bright neon green background for easy background removal, high contrast edges, no shadows on background, studio lighting.";
                }

                // Melakukan 4 variasi sekaligus untuk Batch Generation
                const tasks = [
                    generateImage(finalPrompt + " --v1", isTransparent),
                    generateImage(finalPrompt + " --v2", isTransparent),
                    generateImage(finalPrompt + " --v3", isTransparent),
                    generateImage(finalPrompt + " --v4", isTransparent)
                ];

                const results = await Promise.all(tasks);
                const validImages = results.filter(img => img !== null);

                if (validImages.length > 0) {
                    renderGrid(validImages);
                    showToast("GENERASI ULTRA HD SELESAI", "success");
                } else {
                    throw new Error("Failed");
                }
            } catch (err) {
                if (err.name !== 'AbortError') showToast("KONEKSI ENGINE TERPUTUS", "error");
            } finally {
                toggleLoading(false);
            }
        };

        async function generateImage(prompt, removeBg) {
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;
                const body = { 
                    instances: { prompt: prompt }, 
                    parameters: { sampleCount: 1 } 
                };

                const res = await fetch(url, { 
                    method: 'POST', 
                    signal: controller.signal, 
                    body: JSON.stringify(body) 
                });
                
                const data = await res.json();
                const base64 = data.predictions?.[0]?.bytesBase64Encoded;
                
                if (!base64) return null;
                const dataUrl = `data:image/png;base64,${base64}`;

                // Jika fitur transparansi aktif, lakukan pemrosesan background removal di sisi klien (Chroma Keying)
                return removeBg ? await processTransparency(dataUrl) : dataUrl;
            } catch (e) { return null; }
        }

        // Fitur Pembersihan Background Profesional (Chroma Key Removal)
        function processTransparency(dataUrl) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const pixels = imgData.data;

                    // Deteksi warna dominan di pojok (asumsi background) atau warna hijau neon dari prompt
                    for (let i = 0; i < pixels.length; i += 4) {
                        const r = pixels[i];
                        const g = pixels[i+1];
                        const b = pixels[i+2];

                        // Algoritma Removal: Menghapus warna yang mendekati hijau neon/terang yang kita minta di prompt
                        if (g > 150 && g > r * 1.2 && g > b * 1.2) {
                            pixels[i+3] = 0; // Set Alpha ke 0 (Transparan)
                        }
                    }

                    ctx.putImageData(imgData, 0, 0);
                    resolve(canvas.toDataURL('image/png'));
                };
                img.src = dataUrl;
            });
        }

        function renderGrid(images) {
            ui.resultGrid.innerHTML = '';
            images.forEach((src, idx) => {
                const card = document.createElement('div');
                card.className = "image-card aspect-square";
                card.innerHTML = `
                    <img src="${src}" class="w-full h-full object-contain">
                    <div class="image-overlay">
                        <button onclick="saveImage('${src}', ${idx})" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-2xl text-[10px] font-black uppercase flex items-center space-x-3 transition-all active:scale-90 shadow-2xl">
                            <i class="fas fa-download"></i><span>Simpan Ultra HD</span>
                        </button>
                    </div>
                `;
                ui.resultGrid.appendChild(card);
            });
            ui.resultGrid.classList.remove('hidden');
            ui.globalActions.classList.remove('hidden');
            ui.empty.classList.add('hidden');
        }

        window.saveImage = (url, i) => {
            const a = document.createElement('a');
            a.href = url;
            a.download = `AssetForge_HD_${Date.now()}_${i}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast("GAMBAR TERSIMPAN KE GALERI", "success");
        };

        function toggleLoading(active) {
            ui.loading.classList.toggle('hidden', !active);
            if (active) {
                ui.empty.classList.add('hidden');
                ui.resultGrid.classList.add('hidden');
                ui.globalActions.classList.add('hidden');
            }
            ui.genBtn.disabled = active;
            ui.genText.innerText = active ? "Processing HD..." : "Generate Ultra HD";
        }

        function showToast(msg, type) {
            const t = idEl('toast');
            idEl('toast-msg').innerText = msg;
            t.style.borderLeftColor = type === 'success' ? '#10b981' : '#f43f5e';
            t.classList.remove('translate-y-32', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-32', 'opacity-0'), 4000);
        }

        ui.resetBtn.onclick = () => {
            ui.resultGrid.innerHTML = '';
            ui.resultGrid.classList.add('hidden');
            ui.globalActions.classList.add('hidden');
            ui.empty.classList.remove('hidden');
            ui.prompt.value = '';
        };
    </script>
</body>
</html>
